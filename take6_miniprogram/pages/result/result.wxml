<!-- ç»“ç®—é¡µé¢ -->
<view class="container">
  <!-- é¡¶éƒ¨æ ‡é¢˜ -->
  <view class="header">
    <text class="round-tag">ç¬¬ {{currentRound}} å±€ Â· ç‰Œå±€ç»“æŸ</text>
    <view class="header-row">
      <text class="page-title">æœ¬å±€ç»“ç®—</text>
      <text class="remaining-rounds">è·ç¦»ç»ˆå±€è¿˜æœ‰ <text class="highlight">{{remainingRounds}}</text> å±€</text>
    </view>
  </view>

  <!-- èƒŒæ™¯åº†ç¥å›¾ -->
  <view class="bg-image">
    <image class="bg-img" src="/images/celebration-bg.jpg" mode="aspectFill"></image>
    <view class="bg-overlay"></view>
  </view>

  <scroll-view scroll-y class="content">
    <!-- æ’è¡Œæ¦œå¡ç‰‡ -->
    <view class="ranking-card">
      <view class="card-header">
        <view class="header-left">
          <text class="trophy-icon">ğŸ†</text>
          <text class="card-title">æœ¬å±€æ’è¡Œæ¦œ</text>
        </view>
        <text class="card-hint">ç‰›å¤´è¶Šå°‘æ’åè¶Šå‰</text>
      </view>

      <!-- å† äºšå­£å†› -->
      <view class="podium" wx:if="{{rankings.length >= 3}}">
        <view class="podium-item second">
          <image class="podium-avatar" src="{{rankings[1].avatarUrl || '/images/default-avatar.png'}}" mode="aspectFill"></image>
          <text class="podium-name">{{rankings[1].name}}</text>
          <text class="podium-score">{{rankings[1].score}} ç‰›</text>
          <text class="podium-rank">äºšå†›</text>
        </view>

        <view class="podium-item first">
          <view class="crown-wrapper">
            <image class="podium-avatar champion" src="{{rankings[0].avatarUrl || '/images/default-avatar.png'}}" mode="aspectFill"></image>
            <text class="crown-icon">ğŸ‘‘</text>
          </view>
          <text class="podium-name">{{rankings[0].name}}</text>
          <text class="podium-score champion-score">{{rankings[0].score}} ç‰›</text>
          <text class="podium-rank mvp">æœ¬å±€ MVP</text>
        </view>

        <view class="podium-item third">
          <image class="podium-avatar" src="{{rankings[2].avatarUrl || '/images/default-avatar.png'}}" mode="aspectFill"></image>
          <text class="podium-name">{{rankings[2].name}}</text>
          <text class="podium-score">{{rankings[2].score}} ç‰›</text>
          <text class="podium-rank">å­£å†›</text>
        </view>
      </view>

      <!-- æœ¬å±€æ˜ç»† -->
      <view class="details-card">
        <view class="detail-item" wx:for="{{rankings}}" wx:key="id">
          <text class="detail-name">{{item.name}}</text>
          <text class="detail-score {{item.isMe ? 'my-score' : ''}}">-{{item.score}} ç‰›</text>
        </view>
      </view>
    </view>

    <!-- ç´¯è®¡ç§¯åˆ†åŒº -->
    <view class="total-score-card">
      <view class="card-header">
        <text>æ€»ç§¯åˆ†ï¼ˆç‰›å¤´ç´¯åŠ ï¼‰</text>
        <text class="target-hint">ç›®æ ‡ï¼šæœ‰äººè¶…è¿‡ <text class="highlight">{{targetScore}}</text> åˆ†ç»“æŸ</text>
      </view>
      <view class="total-list">
        <view class="total-item" wx:for="{{totalScores}}" wx:key="id">
          <view class="total-left">
            <text wx:if="{{item.isMe}}" class="fire-icon">ğŸ”¥</text>
            <text class="total-name">{{item.name}}</text>
          </view>
          <text class="total-value {{item.isMe ? 'my-total' : ''}}">{{item.total}} ç‰›</text>
        </view>
      </view>
    </view>

    <!-- æ“ä½œæŒ‰é’® -->
    <view class="actions">
      <button class="action-btn review" bindtap="handleReview">
        <text class="action-icon">ğŸ“Š</text>
        <text>æŸ¥çœ‹æœ¬å±€å¤ç›˜</text>
      </button>
      <button class="action-btn again" bindtap="handlePlayAgain">
        <text class="action-icon">ğŸ”„</text>
        <text>å†æ¥ä¸€å±€</text>
      </button>
    </view>

    <button class="share-btn" bindtap="handleShare" open-type="share">
      <text class="share-icon">ğŸ“¤</text>
      <text>åˆ†äº«æˆ˜ç»©æµ·æŠ¥</text>
    </button>
  </scroll-view>

  <!-- æµ·æŠ¥å¼¹çª— -->
  <view class="poster-modal" wx:if="{{showPoster}}">
    <view class="poster-mask" catchtap="handleClosePoster"></view>
    <view class="poster-content">
      <view class="poster-header">
        <text class="poster-title">æˆ˜ç»©æµ·æŠ¥</text>
        <text class="poster-close" catchtap="handleClosePoster">âœ•</text>
      </view>
      <image class="poster-image" src="{{posterPath}}" mode="widthFix"></image>
      <view class="poster-actions">
        <button class="poster-btn save" catchtap="handleSavePoster">
          <text class="poster-btn-icon">ğŸ’¾</text>
          <text>ä¿å­˜åˆ°ç›¸å†Œ</text>
        </button>
        <button class="poster-btn share" open-type="share">
          <text class="poster-btn-icon">ğŸ“¤</text>
          <text>åˆ†äº«ç»™å¥½å‹</text>
        </button>
      </view>
    </view>
  </view>

  <!-- éšè—çš„ Canvasï¼ˆç”¨äºç”Ÿæˆæµ·æŠ¥ï¼‰ -->
  <canvas 
    id="posterCanvas" 
    type="2d" 
    style="position: fixed; top: -9999px; left: -9999px; width: {{canvasWidth}}px; height: {{canvasHeight}}px;">
  </canvas>
</view>

